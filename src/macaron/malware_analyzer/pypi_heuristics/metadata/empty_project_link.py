# Copyright (c) 2024 - 2024, Oracle and/or its affiliates. All rights reserved.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl/.

"""Analyzer checks there is no project link of the package."""

from macaron.malware_analyzer.pypi_heuristics.base_analyzer import BaseHeuristicAnalyzer
from macaron.malware_analyzer.pypi_heuristics.heuristics import HeuristicResult, Heuristics
from macaron.slsa_analyzer.package_registry.pypi_registry import PyPIRegistry


class EmptyProjectLinkAnalyzer(BaseHeuristicAnalyzer):
    """Analyzer checks heuristic."""

    def __init__(self) -> None:
        super().__init__(name="empty_project_link_analyzer", heuristic=Heuristics.EMPTY_PROJECT_LINK, depends_on=None)

    def analyze(self, api_client: PyPIRegistry) -> tuple[HeuristicResult, dict]:
        """Check whether the PyPI package has no project link.

        Parameters
        ----------
        api_client: PyPIRegistry
            The API client.

        Returns
        -------
        tuple[HeuristicResult, dict]
            The result and project links if they exist. Otherwise, return an empty dictionary
        """
        project_links: dict[str, str] | None = api_client.get_project_links()

        if project_links is None:
            return HeuristicResult.SKIP, {}

        if len(project_links) == 0:  # Total.
            return HeuristicResult.FAIL, {}

        return HeuristicResult.PASS, {"project_links": project_links}
